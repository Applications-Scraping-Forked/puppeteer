name: puppeteer-chrome
description: Run Test through Puppeteer, the headless chrome Node API
author: tj-actions
inputs:
  token:
    description: '[GITHUB_TOKEN](https://docs.github.com/en/free-pro-team@latest/actions/reference/authentication-in-a-workflow#using-the-github_token-in-a-workflow) or a repo scoped [Personal Access Token](https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token)'
    required: true
    default: ${{ github.token }}
  node-version:
    description: 'Node version'
    required: false
    default: '14'
  args:
    description: 'Command to run puppeteer'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Set up QEMU
      uses: docker/setup-qemu-action@v2.1.0

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2.2.1

    - name: Docker Build
      uses: docker/build-push-action@v3
      id: docker-build
      with:
        context: .
        load: true
        push: false
        tags: ${{ github.repository }}:local-node-${{ inputs.node-version }}
        cache-from: |
          ghcr.io/${{ github.repository }}:node-${{ inputs.node-version }}
          type=gha
        cache-to: |
          type=gha,mode=max

    - name: Docker Run
      uses: docker://puppeteer:local-node-${{ inputs.node-version }}
      id: docker-run
      with:
        args: ${{ inputs.args }}
branding:
  icon: camera-off
  color: white
